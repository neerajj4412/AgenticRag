name: Agentic RAG CI

on:
  push:
  pull_request:

jobs:
  test:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        python-version: ["3.11", "3.12"]

    steps:
      # 1️⃣ Checkout code
      - name: Checkout repo
        uses: actions/checkout@v4

      # 2️⃣ Set up Python
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: ${{ matrix.python-version }}

      # 3️⃣ Install uv and project dependencies
      - name: Install uv and dependencies
        run: |
          pip install uv jupyter ipykernel
          uv pip install --system -r requirements.txt

      # 4️⃣ Ensure python3 kernel exists
      - name: Install python3 kernel
        run: |
          python -m ipykernel install --user --name python3 --display-name "Python 3"

      # 5️⃣ Sanity check: compile all Python files
      - name: Sanity check (import + syntax)
        run: python -m compileall .

      # 6️⃣ Run evaluation notebook
      - name: Run eval notebook
        env:
          WEATHER_API_KEY: ${{ secrets.WEATHER_API_KEY }}
          GROQ_API_KEY: ${{ secrets.GROQ_API_KEY }}
        run: |
          jupyter nbconvert \
            --to notebook \
            --execute AgenticRAG.ipynb \
            --ExecutePreprocessor.timeout=600 \
            --ExecutePreprocessor.kernel_name=python3 \
            --output AgenticRAG.executed.ipynb


